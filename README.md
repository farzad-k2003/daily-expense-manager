<div dir="rtl">

# مدیریت هزینه‌های روزانه (Daily Expense Manager)

یک وب‌اپلیکیشن سبک، سریع و بدون بک‌اند برای ثبت و تحلیل هزینه‌های شخصی روزانه.  
این پروژه با **React + TypeScript + Vite** پیاده‌سازی شده و تمام داده‌ها را روی **LocalStorage** مرورگر ذخیره می‌کند.

---

## نمای کلی محصول

این محصول برای مدیریت هزینه‌های شخصی در سطح روزانه و ماهانه طراحی شده است:

- ثبت هزینه با عنوان، مبلغ و دسته‌بندی
- مشاهده مجموع هزینه‌های امروز
- نمایش لیست هزینه‌های امروز
- نمایش توزیع هزینه‌ها به تفکیک دسته در قالب **Pie Chart**
- مدیریت دسته‌بندی‌ها (افزودن/حذف)
- ذخیره‌سازی کامل داده‌ها در مرورگر (بدون سرور)

> این اپ برای استفاده شخصی و سبک مناسب است؛ اگر کش مرورگر پاک شود یا مرورگر عوض شود، داده‌ها منتقل نمی‌شوند.

---

## امکانات به‌صورت جزئی

### 1) صفحه امروز (`/daily-expense-manager/`)

- فرم افزودن هزینه شامل:
  - `name`: نام هزینه (متن)
  - `amount`: مبلغ (عددی)
  - `typeId`: نوع/دسته هزینه
- پس از ثبت هزینه:
  - رکورد به آرایه هزینه‌ها اضافه می‌شود
  - در `localStorage` ذخیره می‌شود
  - UI بلافاصله به‌روزرسانی می‌شود
- در همین صفحه:
  - مجموع هزینه‌های امروز محاسبه و نمایش داده می‌شود
  - لیست هزینه‌های امروز با تاریخ شمسی (`fa-IR`) نمایش داده می‌شود

### 2) صفحه ماهانه (`/daily-expense-manager/monthly`)

- هزینه‌ها بر اساس دسته‌بندی گروه‌بندی می‌شوند (`groupByType`)
- خروجی در دو حالت نمایش داده می‌شود:
  - نمودار دایره‌ای SVG تعاملی
  - لیست خلاصه هر دسته شامل رنگ، نام دسته و مجموع مبلغ
- برای هر اسلایس:
  - Hover/Focus باعث هایلایت می‌شود
  - Tooltip مقدار و درصد را نمایش می‌دهد
  - ویژگی‌های دسترس‌پذیری (`aria-label`, `title`, `desc`, `sr-only`) رعایت شده است

### 3) صفحه تنظیمات (`/daily-expense-manager/settings`)

- افزودن نوع هزینه جدید با:
  - نام
  - رنگ
- حذف نوع هزینه با محدودیت مهم:
  - اگر نوع موردنظر قبلا در هزینه‌ها استفاده شده باشد، حذف انجام نمی‌شود
- نوع پیش‌فرض `other` قابل حذف نیست

---

## تکنولوژی‌ها و ابزارها

- **React 19** (کامپوننت تابعی + Hook)
- **TypeScript** (Strict Mode)
- **Vite** (با `rolldown-vite` override)
- **React Router** برای مسیردهی
- **ESLint** + `typescript-eslint` + `react-hooks`
- **gh-pages** برای استقرار روی GitHub Pages

---

## معماری و جریان داده

### معماری کلی

- اپ به‌صورت SPA اجرا می‌شود
- `RouterProvider` روت‌ها را مدیریت می‌کند
- `Layout` شامل `main` و `nav` ثابت پایین صفحه است
- هر صفحه مسئول خواندن/نمایش داده خودش است

### جریان داده هزینه‌ها

1. فرم هزینه در Dashboard رکورد را می‌سازد.
2. `storage.saveExpenses` آرایه جدید را در `localStorage` ذخیره می‌کند.
3. state صفحه به‌روزرسانی می‌شود.
4. در تب‌های دیگر، رویداد `storage` دریافت و داده همگام می‌شود.

### جریان داده نوع‌ها

1. Settings نوع جدید را می‌سازد یا حذف می‌کند.
2. `storage.saveTypes` مقدار جدید را ذخیره می‌کند.
3. state محلی صفحه تنظیمات به‌روزرسانی می‌شود.
4. سایر کامپوننت‌ها نوع‌ها را هنگام رندر از storage می‌خوانند.

---

## ساختار پوشه‌ها

```text
src/
  app/
    App.tsx
    router.tsx
    style.css
  components/
    expenses/         # فرم ثبت هزینه
    expenseList/      # لیست هزینه‌ها
    pieChart/         # نمودار دایره‌ای SVG
    layout/           # اسکلت صفحه + ناوبری
    text/             # کامپوننت متن ساده
    index.ts
  constants/
    types/            # تایپ‌های Expense و ExpenseType
    index.ts
  pages/
    dashbaord/        # صفحه امروز (نام پوشه با typo)
    monthly/          # صفحه گزارش/نمودار
    settings/         # مدیریت نوع هزینه
    index.ts
  storage/
    index.ts          # لایه دسترسی به LocalStorage
  utils/
    groupByType.ts
    id.ts
    date.ts
    expenses.ts       # فعلا خالی
    index.ts
  main.tsx
```

---

## مدل داده

### نوع هزینه (`ExpenseType`)

```ts
{
  id: string;
  name: string;
  color: string;
}
```

### رکورد هزینه (`Expense`)

```ts
{
  id: string;
  name: string;
  amount: number;
  typeId: string;
  date: string; // ISO
}
```

### کلیدهای LocalStorage

- `expenses`
- `types`

### رفتار Storage Layer (`src/storage/index.ts`)

- `safeParse` برای جلوگیری از crash هنگام JSON نامعتبر
- اعتبارسنجی رکوردها با type guard:
  - `isExpense`
  - `isExpenseType`
- اگر `types` نامعتبر یا خالی باشد، لیست پیش‌فرض برگردانده و ذخیره می‌شود
- نوع‌های پیش‌فرض:
  - `other`
  - `transport`
  - `food`
  - `clothes`

---

## جزئیات پیاده‌سازی نمودار دایره‌ای

کامپوننت `src/components/pieChart/index.tsx`:

- مجموع (`total`) با `useMemo` محاسبه می‌شود
- برای هر دسته:
  - `startAngle`
  - `sliceAngle`
- تبدیل زاویه به مختصات با `polarToCartesian`
- رندر اسلایس‌ها:
  - اگر فقط یک دسته وجود داشته باشد: `circle`
  - در غیر این صورت: `path` با دستور `A` در SVG
- وضعیت `active` برای tooltip و کم/زیاد کردن opacity استفاده می‌شود

---

## مسیرها و ناوبری

در `src/app/router.tsx`:

- `/daily-expense-manager/` -> Dashboard
- `/daily-expense-manager/monthly` -> Monthly
- `/daily-expense-manager/settings` -> Settings

`vite.config.ts` هم `base: "/daily-expense-manager/"` دارد تا با GitHub Pages سازگار باشد.

---

## استایل و تجربه کاربری

- RTL به‌صورت سراسری فعال است (`direction: rtl`)
- فونت اصلی: `Vazirmatn`
- تم تیره با CSS Variables:
  - `--bg`, `--surface`, `--border`, `--text`, `--muted`, `--accent`
- ناوبری پایین صفحه برای تجربه موبایل‌محور

---

## اسکریپت‌ها

```bash
npm run dev
npm run build
npm run preview
npm run lint
npm run deploy
```

### توضیح اسکریپت‌ها

- `dev`: اجرای محیط توسعه Vite
- `build`: بررسی تایپ + بیلد نهایی
- `preview`: اجرای خروجی بیلد روی سرور محلی
- `lint`: بررسی قوانین ESLint
- `deploy`: انتشار `dist` روی GitHub Pages

---

## راه‌اندازی پروژه

### پیش‌نیاز

- Node.js 18+ (ترجیحا نسخه LTS جدید)
- npm

### نصب و اجرا

```bash
npm install
npm run dev
```

### بیلد برای تولید

```bash
npm run build
npm run preview
```

---

## نقاط قوت فعلی پروژه

- معماری ساده و قابل فهم
- Type safety مناسب در لایه داده
- وابستگی کم و عملکرد خوب
- تجربه کاربری خوب برای موبایل
- پیاده‌سازی نمودار بدون کتابخانه جانبی

---

## محدودیت‌ها و نکات مهم فعلی

این موارد در کد فعلی وجود دارند و برای شفافیت محصول باید در نظر گرفته شوند:

1. صفحه «ماه اخیر» در عمل همه هزینه‌ها را گروه‌بندی می‌کند، نه فقط یک ماه اخیر.
2. شناسه رکوردها با `Math.random()` ساخته می‌شود؛ احتمال تکرار بسیار کم ولی صفر نیست.
3. ویرایش/حذف هزینه ثبت‌شده هنوز وجود ندارد.
4. همگام‌سازی `storage` بین تب‌ها انجام می‌شود، اما برای نوع‌ها listener مجزا وجود ندارد.
5. برخی متن‌ها/نام‌ها نیاز به یکدست‌سازی دارند (مثلا نام پوشه `dashbaord`).
6. فایل `src/utils/expenses.ts` فعلا خالی است.
7. به‌دلیل استفاده از LocalStorage، داده‌ها:
   - به حساب کاربری متصل نیستند
   - بین دستگاه‌ها sync نمی‌شوند
   - با پاک شدن داده مرورگر از بین می‌روند

---

## پیشنهاد توسعه (Roadmap)

- فیلتر واقعی ماهانه/بازه زمانی
- ویرایش و حذف هزینه
- جستجو و فیلتر پیشرفته
- خروجی Excel/CSV
- بکاپ/Restore از JSON
- افزودن تست واحد و تست کامپوننت
- پشتیبانی از چند ارز
- امکان تعیین بودجه ماهانه و هشدار

---

## کیفیت کد

- TypeScript با تنظیمات strict فعال است
- ESLint برای TS و Hooks تنظیم شده
- ساختار ماژولار و پوشه‌بندی شفاف

---

## دیپلوی روی GitHub Pages

تنظیمات لازم در پروژه موجود است:

- `homepage` در `package.json`
- `base` در `vite.config.ts`
- اسکریپت `deploy`

برای انتشار:

```bash
npm run build
npm run deploy
```

---

## خلاصه

این پروژه یک محصول مینیمال اما کاربردی برای مدیریت هزینه شخصی است که با تمرکز روی سادگی، سرعت و استقلال از بک‌اند ساخته شده. برای استفاده روزمره سبک بسیار مناسب است و پایه فنی خوبی برای توسعه به نسخه پیشرفته‌تر دارد.

</div>
